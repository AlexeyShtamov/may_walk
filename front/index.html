<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú–∞–π—Å–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ ‚Äî –º–∞—Ä—à—Ä—É—Ç—ã</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="topbar__left">
        <span class="logo-mark">–ª–æ–≥–æ—Ç–∏–ø</span>
        <div class="title">–ú–ê–ô–°–ö–ê–Ø –ü–†–û–ì–£–õ–ö–ê</div>
      </div>
      <div class="topbar__right">
        <button class="ghost-btn" @click="openRoute">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
        </button>
      </div>
    </header>

    <div class="workspace">
      <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
      <aside class="sidebar">
        <div class="sidebar__inner">
          <section class="card">
            <div class="card__title">–†–µ–∂–∏–º</div>
            <div class="card__controls card__controls--inline">
              <label class="choice"><input type="radio" value="free" v-model="mode" /> –°–≤–æ–±–æ–¥–Ω—ã–π</label>
              <label class="choice"><input type="radio" value="point" v-model="mode" /> –¢–æ—á–µ—á–Ω—ã–π</label>
            </div>
          </section>

          <section class="card">
            <div class="card__title">–ü—Ä–∏–≤—è–∑–∫–∞</div>
            <div class="card__controls card__controls--stacked">
              <label class="toggle"><input type="checkbox" v-model="snapToRoads" disabled /><span>–ü–æ –¥–æ—Ä–æ–≥–∞–º</span></label>
              <label class="toggle"><input type="checkbox" v-model="snapToArchive" /><span>–ö –∞—Ä—Ö–∏–≤—É</span></label>
              <div class="slider-row">
                <div class="slider-row__label">–í–¥–æ–ª—å –º–∞—Ä—à—Ä—É—Ç (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –Ω–µ–≥–æ) - {{ archiveThreshold }} –º</div>
                <input type="range" min="10" max="120" v-model.number="archiveThreshold" />
              </div>
            </div>
          </section>

          <section class="card">
            <div class="card__title">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
            <div class="card__controls card__controls--stacked">
              <label class="toggle"><input type="checkbox" v-model="showOldRoutes" /><span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã</span></label>
              <label class="toggle"><input type="checkbox" v-model="focusOnRoute" /><span>–û—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞</span></label>
              <div class="tile-select">
                <label>–ü–æ–¥–ª–æ–∂–∫–∞</label>
                <select v-model="tileLayer" @change="setTile(tileLayer)">
                  <option value="osm">OSM</option>
                  <option value="arcgis">ArcGIS</option>
                  <option value="wikimapia">Wikimapia</option>
                  <option value="google">Google</option>
                  <option value="yandex">Yandex</option>
                  <option value="satellite">–°–ø—É—Ç–Ω–∏–∫</option>
                </select>
              </div>
            </div>
          </section>

          <section class="card">
            <div class="card__title">–ü—É—Ç—å</div>
            <div class="card__controls card__controls--stacked">
              <button class="ghost-btn" :class="{ active: allowAddPoints }" @click="togglePointMode">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
              <button class="ghost-btn" disabled>–ü–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—á–∫–∏</button>
              <button class="ghost-btn" @click="clearRoute">–û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
              <label class="choice"><input type="radio" value="none" v-model="coverageMode" /> –ë–µ–∑ —É—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è</label>
              <label class="choice"><input type="radio" value="use" v-model="coverageMode" /> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∫—Ä—ã—Ç–∏—è</label>
              <label class="choice"><input type="radio" value="view" v-model="coverageMode" /> –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–∫–æ–≤</label>
            </div>
          </section>

          <section class="card">
            <div class="card__title">–°—Ç–∞—Ç—É—Å</div>
            <div class="card__controls card__controls--stacked">
              <select v-model="status" class="status-select">
                <option value="PRELIMINARY">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π üü†</option>
                <option value="FINAL">–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π üü¢</option>
              </select>
            </div>
          </section>

          <section class="card card--muted">
            <div class="card__title">üìè –ú–µ—Ç—Ä–∏–∫–∏</div>
            <div class="metrics">
              <div class="metric-line"><span>–ü—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å:</span><strong>{{ metrics?.totalKm || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–í—Ä–µ–º—è:</span><strong>{{ metrics?.estimatedMinutes || 0 }} –º–∏–Ω</strong></div>
              <div class="metric-line"><span>–ê—Å—Ñ–∞–ª—å—Ç:</span><strong>{{ metrics?.bySurface?.ASPHALT || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–õ–µ—Å–Ω–∞—è —Ç—Ä–æ–ø–∞:</span><strong>{{ metrics?.bySurface?.FOREST_TRAIL || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–ü–æ–ª–µ–≤–æ–π –ø—É—Ç—å:</span><strong>{{ metrics?.bySurface?.FIELD_PATH || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–ñ/–î:</span><strong>{{ metrics?.bySurface?.RAILWAY || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–ß–µ—Ä–Ω–æ–≤–∏–∫:</span><strong>{{ metrics?.preliminaryKm || 0 }} –∫–º</strong></div>
              <div class="metric-line"><span>–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π:</span><strong>{{ metrics?.finalKm || 0 }} –∫–º</strong></div>
            </div>
          </section>

          <section class="card">
            <div class="card__title">–î–µ—Ç–∞–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏—è</div>
            <div class="card__controls card__controls--stacked">
              <label class="toggle"><input type="checkbox" v-model="surfaces.asphalt" /><span>–ê—Å—Ñ–∞–ª—å—Ç: {{ metrics?.bySurface?.ASPHALT || 0 }} –∫–º</span></label>
              <label class="toggle"><input type="checkbox" v-model="surfaces.trail" /><span>–õ–µ—Å–Ω–∞—è —Ç—Ä–æ–ø–∞: {{ metrics?.bySurface?.FOREST_TRAIL || 0 }} –∫–º</span></label>
              <label class="toggle"><input type="checkbox" v-model="surfaces.field" /><span>–ü–æ–ª–µ–≤–æ–π –ø—É—Ç—å: {{ metrics?.bySurface?.FIELD_PATH || 0 }} –∫–º</span></label>
              <label class="toggle"><input type="checkbox" v-model="surfaces.rail" /><span>–ñ/–î: {{ metrics?.bySurface?.RAILWAY || 0 }} –∫–º</span></label>
            </div>
          </section>

          <div class="card actions">
            <button class="primary-btn" @click="saveRoute" :disabled="loading">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="ghost-btn" @click="openExport">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>

          <div class="notice" v-if="notice">{{ notice }}</div>
        </div>
      </aside>

      <!-- –ö–ê–†–¢–ê -->
      <div class="map-wrapper">
        <div id="map"></div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" v-if="showExportModal">
    <div class="modal">
      <div class="modal__header">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞</div>
      <div class="modal__body">
        <label class="choice"><input type="radio" value="gpx" v-model="selectedExportFormat" /> GPX</label>
        <label class="choice"><input type="radio" value="kml" v-model="selectedExportFormat" /> KML</label>
        <label class="choice"><input type="radio" value="kmz" v-model="selectedExportFormat" /> KMZ</label>
      </div>
      <div class="modal__actions">
        <button class="primary-btn" @click="confirmExport">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="ghost-btn" @click="showExportModal = false">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>

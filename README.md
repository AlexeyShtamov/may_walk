# Майская прогулка — редактор маршрутов

Проект состоит из Java Spring Boot API и фронтенда на Vue 3 + Leaflet, которые хранят все данные в памяти. База не нужна: после перезапуска приложения данные сбрасываются, но есть пара демо-маршрутов.

## Быстрый запуск

1. **Backend**
   ```bash
   cd back
   mvn spring-boot:run
   ```
   Сервер поднимется на `http://localhost:8080` и отдаёт REST API `/api/routes`.

2. **Frontend**
   ```bash
   cd front
   python -m http.server 3000
   ```
   Откройте `http://localhost:3000` в браузере. Фронтенд общается с API по адресу `http://localhost:8080`.

## Что умеет приложение

- Рисование маршрута по точкам на карте OSM, фиксация участков с типом покрытия и статусом «черновик»/«финал».
- Привязка к архиву: при клике точки пытаемся приблизить её к ближайшему архивному маршруту (если в радиусе).
- Хранение узловых точек (флаг `node`) — пока без отдельного UI, но поддерживаются при импорте/экспорте.
- Быстрый просмотр метрик: километраж, километраж черновых участков, примерное время.
- Экспорт сохранённого маршрута в GPX/KML/KMZ.
- Импорт GPX/KML по base64 телу запроса (ручные вызовы API).

## REST API

- `GET /api/routes` — список сохранённых маршрутов.
- `POST /api/routes` — создать маршрут (тело: `name`, `status`, `segments`).
- `GET /api/routes/{id}` — маршрут + рассчитанные метрики.
- `PUT /api/routes/{id}` — обновить маршрут.
- `POST /api/routes/{id}/points` — добавить точку в сегмент.
- `POST /api/routes/nearest` — поиск ближайшей точки любого маршрута рядом с координатой (для привязки к архиву).
- `GET /api/routes/{id}/export/{gpx|kml|kmz}` — выгрузка файла.
- `POST /api/routes/import/{gpx|kml}` — импорт base64 GPX/KML (создаёт новый маршрут).

Статусы маршрутов: `PRELIMINARY` или `FINAL`. Типы покрытия: `ASPHALT`, `FOREST_TRAIL`, `FIELD_PATH`, `RAILWAY`, `UNKNOWN`.

## Работа во фронтенде

1. Укажите название и статус маршрута.
2. Нажимайте по карте, чтобы ставить точки. Включённая опция «К архиву» притягивает клики к существующим трекам.
3. Нажмите «Закрепить участок», чтобы сохранить набор точек в список сегментов.
4. «Сохранить маршрут» отправит данные в API и посчитает метрики. После сохранения доступны кнопки экспорта.
5. В шапке доступен список уже сохранённых маршрутов для загрузки в интерфейс.

## Импорт вручную через curl

```bash
# GPX в base64
gpx64=$(base64 -w0 sample.gpx)
curl -X POST http://localhost:8080/api/routes/import/gpx -d "$gpx64"
```

## Ограничения

- Все данные хранятся в памяти — при перезапуске backend они очищаются.
- Привязка к дорогам OSM не реализована (тумблер зарезервирован в UI), но есть привязка к архиву.
- KMZ собирается из KML внутри zip-архива без стилей.
